#!/bin/bash

if [ "$EUID" != "0" ]
then
	echo "$0: Must be root to run $0 $1" >&2
	return 1
fi

SERVICE_USER="$SERVICE_NAME"
SERVICE_CONFIG_USER="$SERVICE_CONFIG_ROOT/service-user"

if [ -f "$SERVICE_CONFIG_USER" ]
then
	. "$SERVICE_CONFIG_USER"
fi

SCRIPT="$SERVICE_SCRIPT_ROOT/manage-service"
echo "Service \"$SERVICE_NAME\" user \"$SERVICE_USER\" invokes: $SCRIPT $*"


sudo -u $SERVICE_USER -H \
	SERVICE_SCRIPT_ROOT="$SERVICE_SCRIPT_ROOT" \
	SERVICE_NAME="$SERVICE_NAME" \
	SERVICE_CONFIG_ROOT="$SERVICE_CONFIG_ROOT" \
	SERVICE_DBUS_INIT="$SERVICE_DBUS_INIT" \
	"$SCRIPT" $*
